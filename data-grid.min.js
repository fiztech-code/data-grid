(()=>{"use strict";var d=Object.assign({itemsPerPage:"Items per page",gotoPage:"Go to page",gotoFirstPage:"Go to first page",gotoPrevPage:"Go to previous page",gotoNextPage:"Go to next page",gotoLastPage:"Go to last page",of:"of",items:"items"},window.DataGridLabels||{}),f=document.createElement("template");f.innerHTML=`
<table role="grid" >
    <thead role="rowgroup">
        <tr role="row" aria-rowindex="1"></tr>
        <tr role="row" aria-rowindex="2"></tr>
    </thead>
    <tbody role="rowgroup"></tbody>
    <tfoot role="rowgroup">
        <tr role="row" aria-rowindex="1">
            <td role="gridcell">
            <div class="dg-footer">
                <div class="dg-page-nav">
                  <select class="dg-per-page" aria-label="${d.itemsPerPage}"></select>
                </div>
                <div class="dg-pagination">
                  <button type="button" class="dg-btn-first dg-rotate" title="${d.gotoFirstPage}" aria-label="${d.gotoFirstPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-prev dg-rotate" title="${d.gotoPrevPage}" aria-label="${d.gotoPrevPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-next" title="${d.gotoNextPage}" aria-label="${d.gotoNextPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-last" title="${d.gotoLastPage}" aria-label="${d.gotoLastPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                  <input type="number" class="dg-goto-page" min="1" step="1" value="1" aria-label="${d.gotoPage}">
                </div>
                <div class="dg-meta">
                  <span class="dg-low"></span> - <span class="dg-high"></span> ${d.of} <span class="dg-total"></span> ${d.items}
                </div>
            </div>
            </td>
        </tr>
    </tfoot>
</table>
`;var n=class extends HTMLElement{constructor(t={}){super();this.state={id:null,pages:0,page:1,perPage:10,perPageValues:[10,25,50,100,250],debug:!1,filter:!1,sort:!1,defaultSort:"",reorder:!1,dir:"ltr",columns:[]},this.setOptions(t),this.data=[],this.originalData=[],this.appendChild(f.content.cloneNode(!0)),this.root=this,this.initialized=!1,this.perPageValues=this.state.perPageValues,this.state.id||(this.state.id=n.randstr("dg-")),this.log("constructor")}static addSelectOption(t,r,e,i=!1){let a=document.createElement("option");a.value=r,i&&(a.selected="selected"),a.label=e,t.appendChild(a)}static randstr(t){return Math.random().toString(36).replace("0.",t||"")}static convertArray(t){return typeof t=="string"?t[0]==="{"?JSON.parse(t):t.split(","):(Array.isArray(t)||console.error("Invalid array",t),t)}static elementOffset(t){var r=t.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:r.top+i,left:r.left+e}}static applyColumnDefinition(t,r){r.width&&t.setAttribute("width",r.width),r.class&&t.setAttribute("class",r.class)}static convertColumns(t){let r=[];return typeof t=="object"&&!Array.isArray(t)?Object.keys(t).forEach(e=>{let i={};i.title=t[e],i.field=e,r.push(i)}):t.forEach(e=>{let i={};typeof e=="string"?(i.title=e,i.field=e):typeof e=="object"?(i=e,i.field||console.error("Invalid column definition",e)):console.error("Column definition must be a string or an object"),r.push(i)}),r}static get observedAttributes(){return["url","page","per-page","debug","filter","sort","default-sort","dir","reorder"]}get page(){return this.getAttribute("page")}set page(t){this.setAttribute("page",t)}get perPage(){return this.getAttribute("per-page")}set perPage(t){this.setAttribute("per-page",t)}get debug(){return this.getAttribute("debug")==="true"}set debug(t){this.setAttribute("debug",t)}get dir(){return this.getAttribute("dir")}set dir(t){t=t.toString().toLowerCase(),["ltr","rtl"].includes(t)&&this.setAttribute("dir",t)}get perPageValues(){return this.state.perPageValues}set perPageValues(t){if(Array.isArray(t)){this.state.perPageValues=t;let r=this.querySelector(".dg-per-page");for(;r.lastChild;)r.removeChild(r.lastChild);this.state.perPageValues.forEach(e=>{n.addSelectOption(r,e,e)})}}get filter(){return this.getAttribute("filter")==="true"}set filter(t){this.setAttribute("filter",t)}get reorder(){return this.getAttribute("reorder")==="true"}set reorder(t){this.setAttribute("reorder",t)}get sort(){return this.getAttribute("sort")==="true"}set sort(t){this.setAttribute("sort",t)}get defaultSort(){return this.getAttribute("default-sort")}set defaultSort(t){this.setAttribute("default-sort",t)}get url(){return this.getAttribute("url")}set url(t){this.setAttribute("url",t)}get columns(){return this.state.columns}set columns(t){this.state.columns=n.convertColumns(n.convertArray(t))}connectedCallback(){this.log("connectedCallback"),this.btnFirst=this.root.querySelector(".dg-btn-first"),this.btnPrev=this.root.querySelector(".dg-btn-prev"),this.btnNext=this.root.querySelector(".dg-btn-next"),this.btnLast=this.root.querySelector(".dg-btn-last"),this.selectPerPage=this.root.querySelector(".dg-per-page"),this.inputPage=this.root.querySelector(".dg-goto-page"),this.getFirst=this.getFirst.bind(this),this.getPrev=this.getPrev.bind(this),this.getNext=this.getNext.bind(this),this.getLast=this.getLast.bind(this),this.changePerPage=this.changePerPage.bind(this),this.gotoPage=this.gotoPage.bind(this),this.btnFirst.addEventListener("click",this.getFirst),this.btnPrev.addEventListener("click",this.getPrev),this.btnNext.addEventListener("click",this.getNext),this.btnLast.addEventListener("click",this.getLast),this.selectPerPage.addEventListener("change",this.changePerPage,{passive:!0}),this.inputPage.addEventListener("input",this.gotoPage),this.loadData(),this.toggleSort(),this.initialized=!0}disconnectedCallback(){this.log("disconnectedCallback"),this.btnFirst.removeEventListener("click",this.getFirst),this.btnPrev.removeEventListener("click",this.getPrev),this.btnNext.removeEventListener("click",this.getNext),this.btnLast.removeEventListener("click",this.getLast),this.btnRefresh.removeEventListener("click",this.refresh),this.selectPerPage.removeEventListener("change",this.changePerPage,{passive:!0}),this.inputPage.removeEventListener("input",this.gotoPage)}attributeChangedCallback(t,r,e){this.log("attributeChangedCallback: "+t);let i;switch(t){case"url":this.state.url=e,this.initialized&&this.loadData();break;case"page":this.state.page=Number(e),this.fixPage(),this.updateGoto(),this.initialized&&this.paginate();break;case"per-page":this.state.perPage=Number(e),this.initialized&&(i=this.selectPerPage,i.value=e,this.fixPage(),this.updateGoto(),this.paginate(),window.scroll({top:n.elementOffset(i).top}));break;case"debug":this.state.debug=e==="true";break;case"dir":this.state.dir=e,this.root.querySelector(".dg-wrapper").dir=this.state.dir;break;case"filter":this.state.filter=e==="true",this.toggleFilter();break;case"reorder":this.state.reorder=e==="true",this.toggleReorder();break;case"sort":this.state.sort=e==="true",this.initialized&&this.toggleSort();break;case"default-sort":this.state.defaultSort=e,this.initialized&&this.toggleSort();break}}setOptions(t){for(let[r,e]of Object.entries(t))r in this&&(this[r]=e)}columnsLength(){let t=0;return this.state.columns.forEach(r=>{r.asClass||t++}),t}fixPage(){this.state.pages=Math.ceil(this.data.length/this.state.perPage),this.state.pages<this.state.page&&(this.state.page=this.state.pages),this.state.page<1&&(this.state.page=1),this.inputPage?this.inputPage.setAttribute("max",this.state.pages):this.root.querySelector(".dg-goto-page").setAttribute("max",this.state.pages)}toggleFilter(){let t=this.root.querySelector("thead tr[aria-rowindex='2']");this.state.filter?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden")}toggleReorder(){this.root.querySelectorAll("thead tr[aria-rowindex='1'] th").forEach(t=>{this.state.reorder?t.draggable=!0:t.removeAttribute("draggable")})}toggleSort(){this.log("toggle sort"),this.root.querySelectorAll("thead tr[aria-rowindex='1'] th").forEach(t=>{this.state.sort?t.setAttribute("aria-sort","none"):t.removeAttribute("aria-sort")})}updateGoto(){let t;this.inputPage?t=this.inputPage:t=this.root.querySelector(".dg-goto-page"),t.value=this.state.page,t.disabled=this.state.pages===1}loadData(){if(this.log("loadData"),!this.url){this.log("No url set yet");return}this.fetchData().then(t=>{if(Array.isArray(t))this.data=t;else{if(!t.data){console.error("Invalid response, it should contain a data key with an array or be a plain array",t);return}t.options&&this.setOptions(t.options),this.data=t.data}this.originalData=this.data.slice(),this.fixPage(),this.root.querySelector("table").setAttribute("aria-rowcount",this.data.length),this.renderHeader()})}getFirst(){this.page=1}getLast(){this.page=this.state.pages}getPrev(){this.page=this.state.page-1}getNext(){this.page=this.state.page+1}refresh(){this.loadData()}changePerPage(){this.perPage=this.selectPerPage.options[this.selectPerPage.selectedIndex].value}gotoPage(t){if(t.type==="keypress"){let r=t.keyCode||t.key;if(r===13||r==="Enter")t.preventDefault();else return}this.page=this.inputPage.value}filterData(){this.log("filter data"),this.data=this.originalData.slice(),this.root.querySelectorAll("thead input").forEach(r=>{let e=r.value;if(e){let i=r.dataset.name;this.data=this.data.filter(a=>(a[i]+"").toLowerCase().indexOf(e.toLowerCase())!==-1)}}),this.state.pages=Math.ceil(this.data.length/this.state.perPage),this.page=1;let t=this.root.querySelector("thead tr[aria-rowindex='1'] th[aria-sort$='scending']");this.state.sort&&t?this.sortData(t):this.renderBody()}sortData(t){this.log("sort data"),this.root.querySelectorAll("thead tr:first-child th").forEach(e=>{e!==t&&e.setAttribute("aria-sort","none")}),!t.hasAttribute("aria-sort")||t.getAttribute("aria-sort")==="none"?t.setAttribute("aria-sort","ascending"):t.getAttribute("aria-sort")==="ascending"?t.setAttribute("aria-sort","descending"):t.getAttribute("aria-sort")==="descending"&&t.setAttribute("aria-sort","none");let r=t.getAttribute("aria-sort");if(r==="none"){let e=[];this.originalData.some(i=>(this.data.some(a=>JSON.stringify(i)===JSON.stringify(a)?(e.push(a),!0):!1),e.length===this.data.length)),this.data=e}else{let e=t.getAttribute("field");this.data.sort((i,a)=>{if(!isNaN(i[e])&&!isNaN(a[e]))return r==="ascending"?i[e]-a[e]:a[e]-i[e];let s=r==="ascending"?i[e].toUpperCase():a[e].toUpperCase(),o=r==="ascending"?a[e].toUpperCase():i[e].toUpperCase();return s>o?1:s<o?-1:0})}this.renderBody()}fetchData(){let t=new URL(this.url,window.location.href),r={r:Math.ceil(Math.random()*9999999)};return Object.keys(r).forEach(e=>t.searchParams.append(e,r[e])),fetch(t).then(e=>e.json())}renderHeader(){this.log("render header");let t,r,e=this.root.querySelector("thead");this.state.columns.length===0&&this.originalData.length&&(this.state.columns=n.convertColumns(Object.keys(this.originalData[0]))),t=document.createElement("tr"),t.setAttribute("role","row"),t.setAttribute("aria-rowindex",1),this.state.columns.forEach((i,a)=>{if(i.asClass)return;let s=document.createElement("th");s.setAttribute("role","columnheader button"),s.setAttribute("aria-colindex",a+1),s.setAttribute("id",n.randstr("dg-col-")),this.state.sort&&s.setAttribute("aria-sort","none"),s.setAttribute("field",i.field),n.applyColumnDefinition(s,i),s.tabIndex=0,s.textContent=i.title,this.state.reorder&&(s.draggable=!0,s.addEventListener("dragstart",o=>{o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/plain",o.target.getAttribute("aria-colindex"))}),s.addEventListener("dragover",o=>(o.preventDefault&&o.preventDefault(),o.dataTransfer.dropEffect="move",!1)),s.addEventListener("drop",o=>{o.stopPropagation&&o.stopPropagation();let l=o.dataTransfer.getData("text/plain"),h=o.target.getAttribute("aria-colindex");if(l===h)return;let y=this.state.columns[l-1];this.state.columns[l-1]=this.columns[h-1],this.state.columns[h-1]=y;let b=(g,u)=>{let A=u.parentNode.getAttribute("aria-rowindex"),c=this.root.querySelector(g+" tr[aria-rowindex='"+A+"'] [aria-colindex='"+h+"']");u.setAttribute("aria-colindex",h),c.setAttribute("aria-colindex",l);let p=document.createElement("th");u.parentNode.insertBefore(p,u),c.parentNode.replaceChild(u,c),p.parentNode.replaceChild(c,p)};return this.root.querySelectorAll("thead th[aria-colindex='"+l+"']").forEach(g=>{b("thead",g)}),this.root.querySelectorAll('tbody td[aria-colindex="'+l+'"]').forEach(g=>{b("tbody",g)}),!1})),t.appendChild(s)}),e.replaceChild(t,e.querySelector("tr[aria-rowindex='1']")),this.state.defaultSort&&(r=this.root.querySelector("thead tr[aria-rowindex='1'] th[field='"+this.state.defaultSort+"']")),t.querySelectorAll("[aria-sort]").forEach(i=>{i.addEventListener("click",()=>{this.sortData(i)})}),t=document.createElement("tr"),t.setAttribute("role","row"),t.setAttribute("aria-rowindex","2"),this.state.filter||t.setAttribute("hidden","hidden"),this.state.columns.forEach((i,a)=>{if(i.asClass)return;let s=e.querySelector("tr[aria-rowindex='1'] th[aria-colindex='"+(a+1)+"']"),o=document.createElement("th");o.setAttribute("aria-colindex",a+1);let l=document.createElement("input");l.type="text",l.autocomplete="off",l.spellcheck=!1,l.dataset.name=i.field,l.id=n.randstr("dg-filter-"),l.setAttribute("aria-labelledby",s.getAttribute("id")),this.state.filter?l.tabIndex=0:o.tabIndex=0,o.appendChild(l),t.appendChild(o)}),e.replaceChild(t,e.querySelector("tr[aria-rowindex='2']")),t.querySelectorAll("input").forEach(i=>{i.addEventListener("keypress",a=>{let s=a.keyCode||a.key;(s===13||s==="Enter")&&this.filterData.call(this)})}),this.root.querySelector("table").setAttribute("aria-colcount",this.columnsLength().toString()),this.root.querySelector("tfoot").querySelector("td").setAttribute("colspan",this.columnsLength().toString()),r?this.sortData(r):this.renderBody(),this.root.querySelector("tfoot").style.display=""}renderBody(){this.log("render body");let t,r,e=document.createElement("tbody");this.data.forEach((i,a)=>{t=document.createElement("tr"),t.setAttribute("role","row"),t.setAttribute("hidden","hidden"),t.setAttribute("aria-rowindex",a+1),t.tabIndex=0,this.state.columns.forEach((s,o)=>{if(s.asClass){t.classList.add(i[s.field]);return}r=document.createElement("td"),r.setAttribute("role","gridcell"),r.setAttribute("aria-colindex",o+1),n.applyColumnDefinition(r,s),r.setAttribute("data-name",s.title),r.tabIndex=-1,r.textContent=i[s.field],t.appendChild(r)}),e.appendChild(t)}),e.setAttribute("role","rowgroup"),this.root.querySelector("table").replaceChild(e,this.root.querySelector("tbody")),this.paginate()}paginate(){this.log("paginate");let t,r=this.state.page*this.state.perPage,e=r-this.state.perPage+1,i=this.root.querySelector("tbody"),a=this.root.querySelector("tfoot");r>this.data.length&&(r=this.data.length),this.data.length||(e=0),i.querySelectorAll("tr").forEach(s=>{t=Number(s.getAttribute("aria-rowindex")),t>r||t<e?s.setAttribute("hidden","hidden"):s.removeAttribute("hidden")}),this.btnFirst&&(this.btnFirst.disabled=this.state.page<=1,this.btnPrev.disabled=this.state.page<=1,this.btnNext.disabled=this.state.page>=this.state.pages,this.btnLast.disabled=this.state.page>=this.state.pages),a.querySelector(".dg-low").textContent=e.toString(),a.querySelector(".dg-high").textContent=r.toString(),a.querySelector(".dg-total").textContent=this.data.length.toString()}log(t){this.debug&&console.log("["+this.state.id+"] "+t)}};customElements.define("data-grid",n);var P=n;})();
//# sourceMappingURL=data-grid.min.js.map
