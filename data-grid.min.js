function v(y){var t=y.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+s,left:t.left+e}}var f={},u=Object.assign({itemsPerPage:"Items per page",gotoPage:"Go to page",gotoFirstPage:"Go to first page",gotoPrevPage:"Go to previous page",gotoNextPage:"Go to next page",gotoLastPage:"Go to last page",of:"of",items:"items",resizeColumn:"Resize column",noData:"No data",areYouSure:"Are you sure?"},window.DataGridLabels||{}),S=document.createElement("template");S.innerHTML=`
<table role="grid" >
    <thead role="rowgroup">
        <tr role="row" aria-rowindex="1" class="dg-head-columns"></tr>
        <tr role="row" aria-rowindex="2" class="dg-head-filters"></tr>
    </thead>
    <tbody role="rowgroup" data-empty="${u.noData}"></tbody>
    <tfoot role="rowgroup" hidden>
        <tr role="row" aria-rowindex="1">
            <td role="gridcell">
            <div class="dg-footer">
                <div class="dg-page-nav">
                  <select class="dg-select-per-page" aria-label="${u.itemsPerPage}"></select>
                </div>
                <div class="dg-pagination">
                  <button type="button" class="dg-btn-first dg-rotate" title="${u.gotoFirstPage}" aria-label="${u.gotoFirstPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-prev dg-rotate" title="${u.gotoPrevPage}" aria-label="${u.gotoPrevPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <input type="number" class="dg-input-page" min="1" step="1" value="1" aria-label="${u.gotoPage}">
                  <button type="button" class="dg-btn-next" title="${u.gotoNextPage}" aria-label="${u.gotoNextPage}" disabled>
                    <i class="dg-nav-icon"></i>
                  </button>
                  <button type="button" class="dg-btn-last" title="${u.gotoLastPage}" aria-label="${u.gotoLastPage}" disabled>
                    <i class="dg-skip-icon"></i>
                  </button>
                </div>
                <div class="dg-meta">
                  <span class="dg-low">0</span> - <span class="dg-high">0</span> ${u.of} <span class="dg-total">0</span> ${u.items}
                </div>
            </div>
            </td>
        </tr>
    </tfoot>
    <ul class="dg-menu" hidden></ul>
</table>
`;var d=class extends HTMLElement{constructor(t={}){super(),this.appendChild(S.content.cloneNode(!0)),this.root=this,this.state={url:null,page:1,perPage:10,debug:!1,filter:!1,sort:!1,server:!1,defaultSort:"",reorder:!1,dir:"ltr",pages:0,perPageValues:[10,25,50,100,250],columns:[],actions:[],collapseActions:!1},this.setOptions(t),this.data=[],this.originalData=[],this.isInitialized=!1,this.touch=null,this.isResizing=!1,this.defaultHeight=0,this.meta={},this.hasAttribute("id")||this.setAttribute("id",d.randstr("dg-")),this.log("constructor")}static registerPlugin(t,e){f[t]=e}static interpolate(t,e){return t.replace(/\{([^}]+)?\}/g,function(s,i){return e[i]})}static getParentNode(t,e,s="nodeName"){let i=t;for(;i[s]!=e;)i=i.parentNode;return i}static getTextWidth(t,e=document.body){let s=window.getComputedStyle(e,null),i=s.getPropertyValue("font-weight")||"normal",a=s.getPropertyValue("font-size")||"1rem",l=s.getPropertyValue("font-family")||"Arial",o=(this.getTextWidth.canvas||(this.getTextWidth.canvas=document.createElement("canvas"))).getContext("2d");o.font=`${i} ${a} ${l}`;let n=o.measureText(t);return parseInt(n.width)}static addSelectOption(t,e,s,i=!1){let a=document.createElement("option");a.value=e,i&&(a.selected="selected"),a.label=s,t.appendChild(a)}static randstr(t){return Math.random().toString(36).replace("0.",t||"")}static convertArray(t){return typeof t=="string"?t[0]==="{"?JSON.parse(t):t.split(","):Array.isArray(t)?t:(console.error("Invalid array",t),{})}static applyColumnDefinition(t,e){e.width&&t.setAttribute("width",e.width),e.class&&t.setAttribute("class",e.class)}static convertColumns(t){let e=[];return typeof t=="object"&&!Array.isArray(t)?Object.keys(t).forEach(s=>{let i={};i.title=t[s],i.field=s,e.push(i)}):t.forEach(s=>{let i={};typeof s=="string"?(i.title=s,i.field=s):typeof s=="object"?(i=s,i.field||console.error("Invalid column definition",s)):console.error("Column definition must be a string or an object"),e.push(i)}),e}static get observedAttributes(){return["url","page","per-page","debug","filter","sort","default-sort","dir","reorder"]}attributeChangedCallback(t,e,s){switch(this.log("attributeChangedCallback: "+t),t){case"url":this.state.url=s,this.isInitialized&&s&&this.loadData().then(()=>{this.configureUi()});break;case"page":this.state.page=Number(s),this.isInitialized&&this.loadData().finally(()=>{this.fixPage(),this.server?this.renderBody():this.paginate()});break;case"per-page":this.state.perPage=Number(s),this.isInitialized&&(this.selectPerPage.value=s,this.loadData().finally(()=>{this.fixPage(),this.server?this.renderBody():this.paginate(),this.sticky&&window.scroll({top:v(this.selectPerPage).top-this.defaultHeight})}));break;case"debug":this.state.debug=s==="true";break;case"dir":this.state.dir=s,this.root.querySelector(".dg-wrapper").dir=this.state.dir;break;case"filter":this.state.filter=s==="true",this.isInitialized&&this.toggleFilter();break;case"reorder":this.state.reorder=s==="true",this.isInitialized&&this.toggleReorder();break;case"sort":this.state.sort=s==="true",this.isInitialized&&this.toggleSort();break;case"default-sort":this.state.defaultSort=s,this.isInitialized&&this.toggleSort();break}}get page(){return this.getAttribute("page")}set page(t){this.setAttribute("page",t)}get perPage(){return this.getAttribute("per-page")}set perPage(t){this.setAttribute("per-page",t)}get debug(){return this.getAttribute("debug")==="true"}set debug(t){this.setAttribute("debug",t)}get dir(){return this.getAttribute("dir")}set dir(t){this.setAttribute("dir",t)}get filter(){return this.getAttribute("filter")==="true"}set filter(t){this.setAttribute("filter",t)}get reorder(){return this.getAttribute("reorder")==="true"}set reorder(t){this.setAttribute("reorder",t)}get sort(){return this.getAttribute("sort")==="true"}set sort(t){this.setAttribute("sort",t)}get defaultSort(){return this.getAttribute("default-sort")}set defaultSort(t){this.setAttribute("default-sort",t)}get url(){return this.getAttribute("url")}set url(t){t?this.setAttribute("url",t):this.removeAttribute("url")}get server(){return this.hasAttribute("server")}set server(t){t?this.setAttribute("server",""):this.removeAttribute("server")}get autosize(){return this.hasAttribute("autosize")}set autosize(t){t?this.setAttribute("autosize",""):this.removeAttribute("autosize")}get resizable(){return this.hasAttribute("resizable")}set resizable(t){t?this.setAttribute("resizable",""):this.removeAttribute("resizable")}get sticky(){return this.hasAttribute("sticky")}set sticky(t){t?this.setAttribute("sticky",""):this.removeAttribute("sticky")}get responsive(){return this.hasAttribute("responsive")}set responsive(t){t?this.setAttribute("responsive",""):this.removeAttribute("responsive")}get expand(){return this.hasAttribute("expand")}set expand(t){t?this.setAttribute("expand",""):this.removeAttribute("expand")}get selectable(){return this.hasAttribute("selectable")}set selectable(t){t?this.setAttribute("selectable",""):this.removeAttribute("selectable")}get perPageValues(){return this.state.perPageValues}set perPageValues(t){if(Array.isArray(t)&&(this.state.perPageValues=t,this.selectPerPage)){for(;this.selectPerPage.lastChild;)this.selectPerPage.removeChild(this.selectPerPage.lastChild);this.state.perPageValues.forEach(e=>{d.addSelectOption(this.selectPerPage,e,e)})}}get columns(){return this.state.columns}set columns(t){this.state.columns=d.convertColumns(d.convertArray(t))}get actions(){return this.state.actions}set actions(t){this.state.actions=d.convertArray(t)}connectedCallback(){this.log("connectedCallback"),this.btnFirst=this.root.querySelector(".dg-btn-first"),this.btnPrev=this.root.querySelector(".dg-btn-prev"),this.btnNext=this.root.querySelector(".dg-btn-next"),this.btnLast=this.root.querySelector(".dg-btn-last"),this.selectPerPage=this.root.querySelector(".dg-select-per-page"),this.inputPage=this.root.querySelector(".dg-input-page"),this.getFirst=this.getFirst.bind(this),this.getPrev=this.getPrev.bind(this),this.getNext=this.getNext.bind(this),this.getLast=this.getLast.bind(this),this.changePerPage=this.changePerPage.bind(this),this.gotoPage=this.gotoPage.bind(this),this.btnFirst.addEventListener("click",this.getFirst),this.btnPrev.addEventListener("click",this.getPrev),this.btnNext.addEventListener("click",this.getNext),this.btnLast.addEventListener("click",this.getLast),this.selectPerPage.addEventListener("change",this.changePerPage,{passive:!0}),this.inputPage.addEventListener("input",this.gotoPage),this.touchstart=this.touchstart.bind(this),this.touchmove=this.touchmove.bind(this),document.addEventListener("touchstart",this.touchstart),document.addEventListener("touchmove",this.touchmove),this.perPageValues=this.state.perPageValues,this.loadData().finally(()=>{this.configureUi(),this.toggleSort(),this.toggleFilter(),this.toggleReorder(),this.root.classList.add("dg-initialized"),this.isInitialized=!0})}disconnectedCallback(){this.log("disconnectedCallback"),this.btnFirst.removeEventListener("click",this.getFirst),this.btnPrev.removeEventListener("click",this.getPrev),this.btnNext.removeEventListener("click",this.getNext),this.btnLast.removeEventListener("click",this.getLast),this.selectPerPage.removeEventListener("change",this.changePerPage,{passive:!0}),this.inputPage.removeEventListener("input",this.gotoPage),document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchmove",this.touchmove),this.selectAll&&this.selectAll.removeEventListener("change",this.toggleSelectAll),this.headerRow&&typeof DataGridContextMenu<"u"&&(this.headerRow.oncontextmenu=null)}toggleSelectAll(){this.root.querySelectorAll("tbody .dg-selectable input").forEach(t=>{t.checked=this.selectAll.checked})}touchstart(t){this.touch=t.touches[0]}touchmove(t){if(!this.touch)return;let e=this.touch.clientX-t.touches[0].clientX,s=this.touch.clientY-t.touches[0].clientY;Math.abs(e)>Math.abs(s)&&(e>0?this.getNext():this.getPrev()),this.touch=null}setOptions(t){if(!(this.reorder&&this.isInitialized))for(let[e,s]of Object.entries(t))e in this&&(this[e]=s,this.state[e]=s)}getColProp(t,e){let s=null;return this.state.columns.forEach(i=>{if(i.field==t){s=i[e];return}}),s}setColProp(t,e,s){this.state.columns.forEach(i=>{i.field==t&&(i[e]=s)})}startIndex(){return this.selectable?2:1}hasActions(){return this.state.actions.length>0}get actionClass(){return this.state.actions.length<3&&!this.state.collapseActions?"dg-actions-"+this.state.actions.length:"dg-actions-more"}columnsLength(t=!1){let e=0;return this.state.columns.forEach(s=>{t&&s.hidden||s.attr||e++}),this.selectable&&e++,this.state.actions.length&&e++,e}computeDefaultHeight(){requestAnimationFrame(()=>{this.defaultHeight=this.root.querySelector("table").offsetHeight,this.style.height&&(this.style.height=this.defaultHeight+"px",this.style.overflowY="auto"),this.style.minHeight&&parseInt(this.style.minHeight)>this.defaultHeight&&(this.style.minHeight=this.defaultHeight+"px")})}configureUi(){if(f.contextMenu&&f.contextMenu.createMenu(this),this.root.querySelector("table").setAttribute("aria-rowcount",this.data.length),this.root.querySelector("tfoot").removeAttribute("hidden"),this.renderHeader(),!this.rowHeight){let t=this.root.querySelector("tbody tr")||this.root.querySelector("table tr");this.rowHeight=t.offsetHeight}}fixPage(){this.state.pages=this.totalPages(),this.state.pages<this.state.page&&(this.state.page=this.state.pages),this.state.page<1&&(this.state.page=1),this.inputPage.setAttribute("max",this.state.pages),this.inputPage.value=this.state.page,this.inputPage.disabled=this.state.pages===1}toggleFilter(){let t=this.root.querySelector("thead tr.dg-head-filters");this.state.filter?t.removeAttribute("hidden"):t.setAttribute("hidden",!0)}toggleReorder(){this.root.querySelectorAll("thead tr.dg-head-columns th").forEach(t=>{t.classList.contains("dg-selectable")||t.classList.contains("dg-actions")||(this.state.reorder?t.draggable=!0:t.removeAttribute("draggable"))})}toggleSort(){this.log("toggle sort"),this.root.querySelectorAll("thead tr.dg-head-columns th").forEach(t=>{let e=t.getAttribute("field");t.classList.contains("dg-selectable")||t.classList.contains("dg-actions")||!this.isInitialized&&e==this.defaultSort||(this.state.sort&&!this.getColProp(e,"noSort")?t.setAttribute("aria-sort","none"):t.removeAttribute("aria-sort"))})}addRow(t){this.log("Add row"),this.originalData.push(t),this.data=this.originalData.slice(),this.fixPage(),this.sortData()}removeRow(t=null,e=null){e===null&&(e=this.columns[0].field),t===null&&(t=this.originalData[this.originalData.length-1][e]),this.log("Removing "+e+":"+t);for(let s=0;s<this.originalData.length;s++)if(this.originalData[s][e]===t){this.originalData.splice(s,1);break}this.data=this.originalData.slice(),this.fixPage(),this.sortData()}getSelection(t=null){let e=[];return this.data.forEach((s,i)=>{this.root.querySelector("tbody tr[aria-rowindex='"+(i+1)+"']").querySelector(".dg-selectable input").checked&&(t?e.push(s[t]):e.push(s))}),e}getData(){return this.originalData}clearData(){this.state.url=null,this.data.length!==0&&(this.data=this.originalData=[],this.fixPage(),this.renderHeader(),this.computeDefaultHeight())}loadData(){return!this.server&&this.originalData.length||this.server&&!this.isInitialized&&this.originalData.length?(this.log("skip loadData"),new Promise(t=>{t()})):(this.log("loadData"),this.loading=!0,this.root.classList.add("dg-loading"),this.fetchData().then(t=>{if(Array.isArray(t))this.data=t;else{if(!t.data){console.error("Invalid response, it should contain a data key with an array or be a plain array",t);return}t.options&&this.setOptions(t.options),t.meta&&(this.meta=t.meta),this.data=t.data}this.originalData=this.data.slice(),this.fixPage(),this.state.columns.length===0&&this.originalData.length&&(this.state.columns=d.convertColumns(Object.keys(this.originalData[0]))),this.root.classList.remove("dg-loading"),this.loading=!1}).catch(t=>{this.url=null,this.log(t)}))}getFirst(){this.loading||(this.page=1)}getLast(){this.loading||(this.page=this.state.pages)}getPrev(){this.loading||(this.page=this.state.page-1)}getNext(){this.loading||(this.page=this.state.page+1)}refresh(){return this.data=this.originalData=[],this.loadData()}changePerPage(){this.perPage=this.selectPerPage.options[this.selectPerPage.selectedIndex].value}gotoPage(t){if(t.type==="keypress"){let e=t.keyCode||t.key;if(e===13||e==="Enter")t.preventDefault();else return}this.page=this.inputPage.value}getSort(){let t=this.root.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t?t.getAttribute("field"):this.defaultSort}getSortDir(){let t=this.root.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");return t&&t.getAttribute("aria-sort")||""}getFilters(){let t=[];return this.root.querySelectorAll("thead tr.dg-head-filters input").forEach(e=>{t[e.dataset.name]=e.value}),t}clearFilters(){this.root.querySelectorAll("thead tr.dg-head-filters input").forEach(t=>{t.value=""}),this.filterData()}filterData(){if(this.log("filter data"),this.server)this.loadData().finally(()=>{this.fixPage(),this.renderBody()});else{this.data=this.originalData.slice(),this.root.querySelectorAll("thead tr.dg-head-filters input").forEach(e=>{let s=e.value;if(s){let i=e.dataset.name;this.data=this.data.filter(a=>(a[i]+"").toLowerCase().indexOf(s.toLowerCase())!==-1)}}),this.fixPage();let t=this.root.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']");this.state.sort&&t?this.sortData(t):this.renderBody()}}sortData(t=null){if(this.log("sort data"),t&&this.getColProp(t.getAttribute("field"),"noSort")){this.log("sorting prevented because column is not sortable");return}if(this.loading){this.log("sorting prevented because loading");return}if(t!==null?(this.root.querySelectorAll("thead tr:first-child th").forEach(e=>{e.classList.contains("dg-selectable")||e.classList.contains("dg-actions")||e!==t&&e.setAttribute("aria-sort","none")}),!t.hasAttribute("aria-sort")||t.getAttribute("aria-sort")==="none"?t.setAttribute("aria-sort","ascending"):t.getAttribute("aria-sort")==="ascending"?t.setAttribute("aria-sort","descending"):t.getAttribute("aria-sort")==="descending"&&t.setAttribute("aria-sort","none")):t=this.root.querySelector("thead tr.dg-head-columns th[aria-sort$='scending']"),this.server)this.loadData().finally(()=>{this.renderBody()});else{let e=t?t.getAttribute("aria-sort"):"none";if(e==="none"){let s=[];this.originalData.some(i=>(this.data.some(a=>JSON.stringify(i)===JSON.stringify(a)?(s.push(a),!0):!1),s.length===this.data.length)),this.data=s}else{let s=t.getAttribute("field");this.data.sort((i,a)=>{if(!isNaN(i[s])&&!isNaN(a[s]))return e==="ascending"?i[s]-a[s]:a[s]-i[s];let l=e==="ascending"?i[s].toUpperCase():a[s].toUpperCase(),r=e==="ascending"?a[s].toUpperCase():i[s].toUpperCase();switch(!0){case l>r:return 1;case l<r:return-1;case l===r:return 0}})}this.renderBody()}}fetchData(){if(!this.url)return new Promise((s,i)=>i("No url set"));let t=new URL(this.url,window.location.href),e={r:Math.ceil(Math.random()*9999999)};return this.server&&(e.start=this.state.page-1,e.length=this.state.perPage,e.search=this.getFilters(),e.sort=this.getSort()||"",e.sortDir=this.getSortDir()),Object.keys(e).forEach(s=>{Array.isArray(e[s])?Object.keys(e[s]).forEach(i=>t.searchParams.append(isNaN(i)?`${s}[${i}]`:s,e[s][i])):t.searchParams.append(s,e[s])}),fetch(t).then(s=>s.json())}renderHeader(){this.log("render header");let t,e=this.root.querySelector("thead");this.createColumnHeaders(e),this.state.defaultSort&&(t=this.root.querySelector("thead tr.dg-head-columns th[field='"+this.state.defaultSort+"']")),this.createColumnFilters(e),this.root.querySelector("table").setAttribute("aria-colcount",this.columnsLength(!0).toString()),this.root.querySelector("tfoot").querySelector("td").setAttribute("colspan",this.columnsLength(!0).toString()),t?this.sortData(t):this.renderBody(),this.root.querySelector("tfoot").style.display="",this.resizable&&f.columnResizer&&f.columnResizer.renderResizer(this,u.resizeColumn)}createColumnHeaders(t){let e=parseInt(t.offsetWidth/this.columnsLength(!0)*2),s=0,i;i=document.createElement("tr"),this.headerRow=i,i.setAttribute("role","row"),i.setAttribute("aria-rowindex",1),i.setAttribute("class","dg-head-columns");let a=document.createElement("th");if(a.setAttribute("role","columnheader button"),a.setAttribute("aria-colindex",1),a.classList.add("dg-selectable"),a.tabIndex=0,this.selectable){this.selectAll=document.createElement("input"),this.selectAll.type="checkbox",this.selectAll.classList.add("dg-select-all"),this.toggleSelectAll=this.toggleSelectAll.bind(this),this.selectAll.addEventListener("change",this.toggleSelectAll);let r=document.createElement("label");r.appendChild(this.selectAll),a.appendChild(r)}a.setAttribute("width",40),i.appendChild(a),s=0;let l=0;if(this.state.columns.forEach(r=>{if(r.attr)return;let o=document.createElement("th");o.setAttribute("role","columnheader button"),o.setAttribute("aria-colindex",s+this.startIndex()),o.setAttribute("id",d.randstr("dg-col-")),this.state.sort&&o.setAttribute("aria-sort","none"),o.setAttribute("field",r.field),o.dataset.minWidth=d.getTextWidth(r.title,o)+40,d.applyColumnDefinition(o,r),o.tabIndex=0,o.textContent=r.title,r.hidden&&o.setAttribute("hidden",!0),this.autosize&&!o.getAttribute("width")&&(l+=this.autosizeColumn(o,r,o.dataset.minWidth,e)),this.state.reorder&&(f.draggableHeaders?f.draggableHeaders.makeHeaderDraggable(o,this):console.error("Plugin not loaded")),i.appendChild(o),s++}),l<t.offsetWidth){let r=i.lastChild;r&&r.removeAttribute("width")}if(this.state.actions.length){let r=document.createElement("th");r.setAttribute("role","columnheader button"),r.setAttribute("aria-colindex",this.columnsLength(!0)),r.classList.add("dg-actions",this.actionClass),r.tabIndex=0,i.appendChild(r)}t.replaceChild(i,t.querySelector("tr.dg-head-columns")),f.contextMenu&&i.addEventListener("contextmenu",r=>{f.contextMenu.showContextMenu(r,this)}),i.querySelectorAll("[aria-sort]").forEach(r=>{r.addEventListener("click",()=>this.sortData(r))})}createColumnFilters(t){let e=0,s;s=document.createElement("tr"),this.filterRow=s,s.setAttribute("role","row"),s.setAttribute("aria-rowindex",2),s.setAttribute("class","dg-head-filters"),this.state.filter||s.setAttribute("hidden",!0);let i=document.createElement("th");i.setAttribute("role","columnheader button"),i.setAttribute("aria-colindex",1),i.classList.add("dg-selectable"),i.tabIndex=0;let a=document.createElement("label");if(i.appendChild(a),s.appendChild(i),this.state.columns.forEach(l=>{if(l.attr)return;let r=t.querySelector("tr.dg-head-columns th[aria-colindex='"+(e+this.startIndex())+"']"),o=document.createElement("th");o.setAttribute("aria-colindex",e+this.startIndex());let n=document.createElement("input");n.type="text",n.autocomplete="off",n.spellcheck=!1,n.dataset.name=l.field,n.id=d.randstr("dg-filter-"),n.setAttribute("aria-labelledby",r.getAttribute("id")),this.state.filter?n.tabIndex=0:o.tabIndex=0,l.hidden&&o.setAttribute("hidden",!0),o.appendChild(n),s.appendChild(o),e++}),this.state.actions.length){let l=document.createElement("th");l.setAttribute("role","columnheader button"),l.setAttribute("aria-colindex",this.columnsLength(!0)),l.classList.add("dg-actions",this.actionClass),l.tabIndex=0,s.appendChild(l)}t.replaceChild(s,t.querySelector("tr.dg-head-filters")),s.querySelectorAll("input").forEach(l=>{l.addEventListener("keypress",r=>{let o=r.keyCode||r.key;(o===13||o==="Enter")&&this.filterData.call(this)})})}autosizeColumn(t,e,s,i){let a=this.data[0][e.field].toString(),l=this.data[this.data.length-1][e.field].toString();l.length>a.length&&(a=l);let r=0;return a.length<=6?r=s:a.length>50?r=i:r=d.getTextWidth(a,t),r<s&&(r=s),t.setAttribute("width",r),parseInt(r)}renderBody(){this.log("render body");let t,e,s,i=document.createElement("tbody");this.selectAll&&i.addEventListener("change",a=>{if(a.target.type!="checkbox"||!a.target.closest(".dg-selectable"))return;let l=this.root.querySelectorAll("tbody .dg-selectable input[type=checkbox]"),r=Array.from(l).filter(o=>o.checked);this.selectAll.checked=r.length==l.length}),this.data.forEach((a,l)=>{if(t=document.createElement("tr"),t.setAttribute("role","row"),t.setAttribute("hidden",!0),t.setAttribute("aria-rowindex",l+1),t.tabIndex=0,this.selectable){e=document.createElement("td"),e.setAttribute("role","gridcell button"),e.setAttribute("aria-colindex",1),e.classList.add("dg-selectable");let r=document.createElement("input");r.type="checkbox";let o=document.createElement("label");o.appendChild(r),e.appendChild(o),t.appendChild(e)}if(this.expand&&t.addEventListener("click",function(){this.classList.toggle("dg-expanded")}),s=0,this.state.columns.forEach(r=>{if(r||console.log(this.state.columns),r.attr){t.setAttribute(r.attr,a[r.field]);return}if(e=document.createElement("td"),e.setAttribute("role","gridcell"),e.setAttribute("aria-colindex",s+this.startIndex()),d.applyColumnDefinition(e,r),e.setAttribute("data-name",r.title),e.tabIndex=-1,r.editable){let o=document.createElement("input");o.type="text",o.autocomplete="off",o.spellcheck=!1,o.tabIndex=0,o.classList.add("dg-editable"),o.name=this.getAttribute("id").replace("-","_")+"["+(l+1)+"]["+r.field+"]",o.value=a[r.field],o.dataset.field=r.field,o.addEventListener("click",n=>n.stopPropagation()),o.addEventListener("keypress",n=>{if(n.type==="keypress"){let h=n.keyCode||n.key;(h===13||h==="Enter")&&o.blur()}}),o.addEventListener("blur",()=>{if(o.value==a[o.dataset.field])return;a[o.dataset.field]=o.value;let n=new CustomEvent("edit",{bubbles:!0,detail:{data:a,value:o.value}});this.dispatchEvent(n)}),e.appendChild(o)}else e.textContent=a[r.field];r.hidden&&e.setAttribute("hidden",!0),t.appendChild(e),s++}),this.state.actions.length){e=document.createElement("td"),e.setAttribute("role","gridcell"),e.setAttribute("aria-colindex",this.columnsLength(!0)),e.classList.add("dg-actions",this.actionClass),e.tabIndex=0;let r=document.createElement("button");r.classList.add("dg-actions-toggle"),r.innerHTML="\u2630",e.appendChild(r),r.addEventListener("click",o=>{o.target.parentNode.classList.toggle("dg-expand")}),this.state.actions.forEach(o=>{let n=document.createElement("button");o.html?n.innerHTML=o.html:n.innerText=o.title??o.name,o.url&&(n.type="submit",n.formAction=d.interpolate(o.url,a)),o.class&&n.classList.add(o.class);let h=g=>{if(g.stopPropagation(),o.confirm&&!confirm(u.areYouSure)){g.preventDefault();return}let m=new CustomEvent("action",{bubbles:!0,detail:{data:a,action:o.name}});this.dispatchEvent(m)};n.addEventListener("click",h),e.appendChild(n),o.default&&(t.classList.add("dg-actionable"),t.addEventListener("click",h))}),t.appendChild(e)}i.appendChild(t)}),i.setAttribute("role","rowgroup"),this.root.querySelector("table").replaceChild(i,this.root.querySelector("tbody")),t=document.createElement("tr"),t.setAttribute("role","row"),t.setAttribute("hidden",!0),t.classList.add("dg-fake-row"),t.tabIndex=0,i.appendChild(t),this.paginate()}paginate(){this.log("paginate");let t=this.totalRecords(),e=this.totalPages(),s,i=this.state.page*this.state.perPage,a=i-this.state.perPage+1,l=this.root.querySelector("tbody"),r=this.root.querySelector("tfoot");i>t&&(i=t),t||(a=0),l.querySelectorAll("tr").forEach(n=>{if(this.server){n.removeAttribute("hidden");return}s=Number(n.getAttribute("aria-rowindex")),s>i||s<a?n.setAttribute("hidden",!0):n.removeAttribute("hidden")}),this.defaultHeight==0&&this.computeDefaultHeight();let o=this.querySelector(".dg-fake-row");if(this.style.height)if(this.state.page==e)if(parseInt(this.style.height)>this.querySelector("tbody").offsetHeight){let n=this.state.perPage-(t-(e-1)*this.state.perPage);o.setAttribute("height",n*this.rowHeight)}else o.removeAttribute("height");else o.removeAttribute("height");this.btnFirst&&(this.btnFirst.disabled=this.state.page<=1,this.btnPrev.disabled=this.state.page<=1,this.btnNext.disabled=this.state.page>=this.state.pages,this.btnLast.disabled=this.state.page>=this.state.pages),r.querySelector(".dg-low").textContent=a.toString(),r.querySelector(".dg-high").textContent=i.toString(),r.querySelector(".dg-total").textContent=this.totalRecords()}totalPages(){return Math.ceil(this.totalRecords()/this.state.perPage)}totalRecords(){return this.server?this.meta.filtered:this.data.length.toString()}log(t){this.debug&&console.log("["+this.getAttribute("id")+"] "+t)}},A=d;var P=class{static renderResizer(t,e){let s=t.root.querySelector("table"),i=t.root.querySelectorAll("thead tr.dg-head-columns th");i.forEach(a=>{if(a.classList.contains("dg-selectable")||a.classList.contains("dg-actions"))return;let l=document.createElement("div");l.classList.add("dg-resizer"),l.ariaLabel=e,a.appendChild(l);let r=0,o=0,n=0,h=0,g=c=>{if(c.clientX>h)return;let p=o+(c.clientX-r);a.dataset.minWidth&&p>a.dataset.minWidth&&(a.width=p)},m=()=>{t.log("resized column"),t.isResizing=!1,l.classList.remove("dg-resizer-active"),t.state.reorder&&(a.draggable=!0),a.style.overflow="hidden",document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",m)};l.addEventListener("click",c=>{c.stopPropagation()}),l.addEventListener("mousedown",c=>{c.stopPropagation(),t.isResizing=!0;let p=t.root.querySelectorAll(".dg-head-columns th"),x=Array.from(p).filter(b=>!b.hasAttribute("hidden")),L=Array.from(x).findIndex(b=>b==c.target.parentNode);t.log("resize column"),l.classList.add("dg-resizer-active"),a.hasAttribute("draggable")&&a.removeAttribute("draggable"),a.style.overflow="visible",l.style.height=s.offsetHeight-1+"px",r=c.clientX,o=a.offsetWidth,n=(x.length-L)*30,h=v(c.target).left+t.offsetWidth-n,a.setAttribute("width",o);for(let b=0;b<x.length;b++)b>L&&i[b].removeAttribute("width");document.addEventListener("mousemove",g),document.addEventListener("mouseup",m)})})}},w=P;var E=class{static showContextMenu(t,e){t.preventDefault();let s=e.constructor.getParentNode(t.target,"THEAD"),i=e.root.querySelector(".dg-menu"),a=s.getBoundingClientRect(),l=t.clientX-a.left,r=t.clientY-a.top;i.style.top=`${r}px`,i.style.left=`${l}px`,i.removeAttribute("hidden"),l+150>a.width&&(l-=i.offsetWidth,i.style.left=`${l}px`);let o=n=>{i.contains(n.target)||(i.setAttribute("hidden",!0),document.removeEventListener("click",o))};document.addEventListener("click",o)}static createMenu(t){let e=t.root.querySelector(".dg-menu");t.state.columns.forEach(s=>{if(s.attr)return;let i=s.field,a=document.createElement("li"),l=document.createElement("label"),r=document.createElement("input");r.setAttribute("type","checkbox"),s.hidden||(r.checked=!0),r.addEventListener("change",n=>{n.target.checked?this.showColumn(i,n.target,t):this.hideColumn(i,n.target,t)});let o=document.createTextNode(s.title);l.appendChild(r),l.appendChild(o),a.appendChild(l),e.appendChild(a)})}static showColumn(t,e=null,s){e&&(e.checked=!0),s.setColProp(t,"hidden",!1),s.renderHeader()}static hideColumn(t,e=null,s){if(s.state.columns.filter(a=>a.hidden===!0).length===s.columnsLength()-1){e&&(e.checked=!0);return}s.setColProp(t,"hidden",!0),s.renderHeader()}},k=E;var C=class{static makeHeaderDraggable(t,e){t.draggable=!0,t.addEventListener("dragstart",s=>{if(e.isResizing&&s.preventDefault){s.preventDefault();return}e.log("reorder col"),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",s.target.getAttribute("aria-colindex"))}),t.addEventListener("dragover",s=>(s.preventDefault&&s.preventDefault(),s.dataTransfer.dropEffect="move",!1)),t.addEventListener("drop",s=>{s.stopPropagation&&s.stopPropagation();let i=e.constructor.getParentNode(s.target,"TH"),a=s.dataTransfer.getData("text/plain"),l=i.getAttribute("aria-colindex");if(a===l){e.log("reordered col stayed the same");return}e.log("reordered col from "+a+" to "+l);let r=e.startIndex(),o=e.state.columns[a-r];e.state.columns[a-r]=e.columns[l-r],e.state.columns[l-r]=o;let n=(h,g)=>{let m=g.parentNode.getAttribute("aria-rowindex"),c=e.root.querySelector(h+" tr[aria-rowindex='"+m+"'] [aria-colindex='"+l+"']");g.setAttribute("aria-colindex",l),c.setAttribute("aria-colindex",a);let p=document.createElement("th");g.parentNode.insertBefore(p,g),c.parentNode.replaceChild(g,c),p.parentNode.replaceChild(c,p)};return e.root.querySelectorAll("thead th[aria-colindex='"+a+"']").forEach(h=>{n("thead",h)}),e.root.querySelectorAll('tbody td[aria-colindex="'+a+'"]').forEach(h=>{n("tbody",h)}),e.state.columns=Array.from(e.root.querySelectorAll("thead tr.dg-head-columns th[field]")).map(h=>e.state.columns.find(g=>g.field==h.getAttribute("field"))),!1})}},q=C;A.registerPlugin("columnResizer",w);A.registerPlugin("contextMenu",k);A.registerPlugin("draggableHeaders",q);customElements.define("data-grid",A);var j=A;export{j as default};
//# sourceMappingURL=data-grid.min.js.map
